{% extends 'base.html' %}

{% block title %}Statistics - Smart Parking System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="bi bi-graph-up"></i> Parking Statistics</h2>
        <hr>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>Occupancy Over Time</h5>
            </div>
            <div class="card-body">
                <canvas id="occupancy-chart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>Statistics History</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Total Spaces</th>
                                <th>Free Spaces</th>
                                <th>Occupied Spaces</th>
                                <th>Vehicle Count</th>
                                <th>Occupancy Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in stats %}
                            <tr>
                                <td>{{ stat.timestamp|date:"Y-m-d H:i:s" }}</td>
                                <td>{{ stat.total_spaces }}</td>
                                <td><span class="badge bg-success">{{ stat.free_spaces }}</span></td>
                                <td><span class="badge bg-danger">{{ stat.occupied_spaces }}</span></td>
                                <td>{{ stat.vehicle_count }}</td>
                                <td>{{ stat.occupancy_rate|floatformat:1 }}%</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted">No statistics available</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
$(document).ready(function() {
    // Parse chart data
    const chartData = {{ chart_data|safe }};
    
    // Create chart
    const ctx = document.getElementById('occupancy-chart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.labels,
            datasets: [
                {
                    label: 'Free Spaces',
                    data: chartData.free_spaces,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                },
                {
                    label: 'Occupied Spaces',
                    data: chartData.occupied_spaces,
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    tension: 0.1
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});
</script>
{% endblock %}
